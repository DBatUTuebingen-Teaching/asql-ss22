-- Waypoint of the tour (latitude/longitude)
--
DROP TYPE IF EXISTS waypoint CASCADE;
CREATE TYPE waypoint AS (
  lat float, -- latitude  [north pole +90째..-90째 south pole]
  lon float  -- longitude [east +180째..-180째 west of meridia]
);

-- Earth distance [m] of points p1 and p2
--
DROP FUNCTION IF EXISTS distance(waypoint, waypoint);
CREATE FUNCTION distance(p1 waypoint, p2 waypoint) RETURNS numeric(10,2) AS
$$
  SELECT (6378000.0 * -- earth radius [m]
          acos(cos(lat1) * cos(lon1) * cos(lat2) * cos(lon2) +
               cos(lat1) * sin(lon1) * cos(lat2) * sin(lon2) +
               sin(lat1) * sin(lat2))) :: numeric(10,2)
  FROM   (VALUES (radians(p1.lat), radians(p1.lon),
                  radians(p2.lat), radians(p2.lon))) AS _(lat1,lon1,lat2,lon2);
$$
LANGUAGE SQL IMMUTABLE;

DROP TABLE IF EXISTS tour;
CREATE TABLE tour (
  id        int GENERATED ALWAYS AS IDENTITY, -- # of waypoint
  waypoint  waypoint,
  elevation float                             --   elevation at waypoint [m]
);

-- Cycling tour from Rottenburg to WSI
-- (tour data exported from GPSies.com, export format "SQL Inserts Track")
--
INSERT INTO tour (waypoint, elevation) VALUES
  ((48.46562280, 8.934599160), 409.0),
  ((48.46562000, 8.934610000), 409.0),
  ((48.46572000, 8.934610000), 409.0),
  ((48.46572000, 8.934570000), 409.0),
  ((48.46571000, 8.934570000), 409.0),
  ((48.46581000, 8.934870000), 407.0),
  ((48.46598000, 8.935250000), 402.0),
  ((48.46598000, 8.935240000), 402.0),
  ((48.46596000, 8.935210000), 402.0),
  ((48.46536000, 8.935790000), 399.0),
  ((48.46474070, 8.936294310), 400.0),
  ((48.46475000, 8.936310000), 400.0),
  ((48.46477000, 8.936290000), 400.0),
  ((48.46480000, 8.936350000), 400.0),
  ((48.46486000, 8.936420000), 399.0),
  ((48.46493000, 8.936440000), 399.0),
  ((48.46508000, 8.936380000), 399.0),
  ((48.46513000, 8.936380000), 399.0),
  ((48.46512000, 8.936380000), 399.0),
  ((48.46522000, 8.936450000), 397.0),
  ((48.46527000, 8.936520000), 397.0),
  ((48.46637000, 8.938460000), 385.0),
  ((48.46662000, 8.938950000), 379.0),
  ((48.46662000, 8.938940000), 379.0),
  ((48.46708000, 8.939850000), 377.0),
  ((48.46717000, 8.939920000), 376.0),
  ((48.46746000, 8.940570000), 373.0),
  ((48.46847000, 8.942450000), 359.0),
  ((48.46860000, 8.942780000), 358.0),
  ((48.46860000, 8.942770000), 358.0),
  ((48.46875000, 8.943150000), 357.0),
  ((48.46897000, 8.944130000), 354.0),
  ((48.46914000, 8.945220000), 350.0),
  ((48.46939000, 8.947260000), 350.0),
  ((48.46950000, 8.947820000), 348.0),
  ((48.46964000, 8.948290000), 348.0),
  ((48.46964000, 8.948280000), 348.0),
  ((48.46996000, 8.949210000), 346.0),
  ((48.46993000, 8.949340000), 346.0),
  ((48.46998000, 8.949380000), 346.0),
  ((48.47003000, 8.949490000), 346.0),
  ((48.47003000, 8.949480000), 346.0),
  ((48.47021000, 8.949940000), 347.0),
  ((48.47033000, 8.950590000), 347.0),
  ((48.47046000, 8.950950000), 348.0),
  ((48.47100000, 8.952210000), 349.0),
  ((48.47105000, 8.952350000), 349.0),
  ((48.47110000, 8.952620000), 349.0),
  ((48.47118000, 8.953640000), 348.0),
  ((48.47126000, 8.954090000), 349.0),
  ((48.47126000, 8.954080000), 349.0),
  ((48.47134000, 8.954510000), 352.0),
  ((48.47154000, 8.955390000), 349.0),
  ((48.47165000, 8.955940000), 349.0),
  ((48.47196000, 8.956610000), 349.0),
  ((48.47206000, 8.956870000), 349.0),
  ((48.47245000, 8.958010000), 348.0),
  ((48.47252000, 8.958270000), 349.0),
  ((48.47285000, 8.959190000), 349.0),
  ((48.47297000, 8.959640000), 347.0),
  ((48.47313000, 8.960320000), 347.0),
  ((48.47313000, 8.960310000), 347.0),
  ((48.47327000, 8.960900000), 349.0),
  ((48.47341000, 8.961670000), 346.0),
  ((48.47393000, 8.965100000), 345.0),
  ((48.47418000, 8.966660000), 347.0),
  ((48.47418000, 8.966650000), 347.0),
  ((48.47421000, 8.966860000), 347.0),
  ((48.47473000, 8.969170000), 344.0),
  ((48.47475000, 8.969250000), 344.0),
  ((48.47474000, 8.969300000), 344.0),
  ((48.47469000, 8.969450000), 344.0),
  ((48.47470000, 8.969620000), 344.0),
  ((48.47453000, 8.969730000), 345.0),
  ((48.47440000, 8.969960000), 345.0),
  ((48.47437000, 8.970050000), 345.0),
  ((48.47435000, 8.970250000), 345.0),
  ((48.47436000, 8.970250000), 345.0),
  ((48.47434000, 8.970470000), 345.0),
  ((48.47429000, 8.970710000), 345.0),
  ((48.47441000, 8.970840000), 345.0),
  ((48.47447000, 8.970990000), 345.0),
  ((48.47450000, 8.971200000), 345.0),
  ((48.47450000, 8.971190000), 345.0),
  ((48.47453000, 8.971750000), 346.0),
  ((48.47471000, 8.973600000), 346.0),
  ((48.47463000, 8.974020000), 345.0),
  ((48.47424000, 8.974250000), 346.0),
  ((48.47429000, 8.974490000), 346.0),
  ((48.47429000, 8.974480000), 346.0),
  ((48.47493000, 8.977390000), 347.0),
  ((48.47493000, 8.977380000), 347.0),
  ((48.47493000, 8.977410000), 347.0),
  ((48.47623000, 8.976560000), 346.0),
  ((48.47623000, 8.976590000), 346.0),
  ((48.47623000, 8.976580000), 346.0),
  ((48.47627000, 8.976780000), 346.0),
  ((48.47630000, 8.977020000), 345.0),
  ((48.47644000, 8.977040000), 345.0),
  ((48.47644000, 8.977030000), 345.0),
  ((48.47687000, 8.978230000), 345.0),
  ((48.47687000, 8.978220000), 345.0),
  ((48.47726000, 8.979270000), 345.0),
  ((48.47741000, 8.979880000), 344.0),
  ((48.47823000, 8.982890000), 341.0),
  ((48.47863000, 8.983850000), 340.0),
  ((48.47863000, 8.983840000), 340.0),
  ((48.47988000, 8.985800000), 340.0),
  ((48.48061000, 8.987080000), 340.0),
  ((48.48094000, 8.987830000), 340.0),
  ((48.48108000, 8.988260000), 340.0),
  ((48.48108000, 8.988250000), 340.0),
  ((48.48121000, 8.988740000), 339.0),
  ((48.48123000, 8.988870000), 339.0),
  ((48.48126000, 8.990300000), 338.0),
  ((48.48134000, 8.991420000), 337.0),
  ((48.48152000, 8.992480000), 339.0),
  ((48.48175000, 8.993700000), 340.0),
  ((48.48188000, 8.994190000), 341.0),
  ((48.48188000, 8.994180000), 341.0),
  ((48.48189000, 8.994200000), 341.0),
  ((48.48132000, 8.994440000), 341.0),
  ((48.48069000, 8.994700000), 340.0),
  ((48.48068000, 8.994670000), 340.0),
  ((48.48067000, 8.994670000), 340.0),
  ((48.48150000, 8.997740000), 339.0),
  ((48.48150000, 8.997730000), 339.0),
  ((48.48164000, 8.998350000), 339.0),
  ((48.48202000, 8.999780000), 340.0),
  ((48.48202000, 8.999770000), 340.0),
  ((48.48207000, 9.000010000), 340.0),
  ((48.48249000, 9.001430000), 342.0),
  ((48.48249000, 9.001420000), 342.0),
  ((48.48249000, 9.001450000), 342.0),
  ((48.48246000, 9.001600000), 342.0),
  ((48.48256000, 9.001780000), 341.0),
  ((48.48256000, 9.001770000), 341.0),
  ((48.48267000, 9.002060000), 341.0),
  ((48.48372000, 9.005840000), 340.0),
  ((48.48372000, 9.005830000), 339.0),
  ((48.48421000, 9.007630000), 339.0),
  ((48.48551000, 9.012580000), 335.0),
  ((48.48622000, 9.012090000), 334.0),
  ((48.48651000, 9.011920000), 332.0),
  ((48.48680000, 9.012790000), 332.0),
  ((48.48721000, 9.014210000), 333.0),
  ((48.48720000, 9.014320000), 333.0),
  ((48.48730000, 9.014590000), 333.0),
  ((48.48737000, 9.014910000), 334.0),
  ((48.48737000, 9.014900000), 334.0),
  ((48.48763000, 9.016060000), 336.0),
  ((48.48796000, 9.017410000), 337.0),
  ((48.48811000, 9.017830000), 337.0),
  ((48.48811000, 9.017960000), 337.0),
  ((48.48811000, 9.017950000), 337.0),
  ((48.48813000, 9.018330000), 336.0),
  ((48.48827000, 9.018610000), 336.0),
  ((48.48854000, 9.018990000), 335.0),
  ((48.48854000, 9.018980000), 335.0),
  ((48.48871000, 9.019200000), 335.0),
  ((48.48886000, 9.019620000), 333.0),
  ((48.48894000, 9.019960000), 332.0),
  ((48.48908000, 9.020710000), 330.0),
  ((48.48927000, 9.022050000), 329.0),
  ((48.48927000, 9.022040000), 329.0),
  ((48.48988000, 9.027310000), 330.0),
  ((48.48993000, 9.027990000), 330.0),
  ((48.48989000, 9.029970000), 330.0),
  ((48.48986000, 9.031350000), 333.0),
  ((48.48980000, 9.032420000), 336.0),
  ((48.48979000, 9.032420000), 336.0),
  ((48.49036000, 9.032700000), 335.0),
  ((48.49066000, 9.033070000), 333.0),
  ((48.49084000, 9.033320000), 331.0),
  ((48.49102000, 9.033670000), 331.0),
  ((48.49134000, 9.034150000), 332.0),
  ((48.49149000, 9.034170000), 331.0),
  ((48.49148000, 9.034170000), 331.0),
  ((48.49149000, 9.034170000), 331.0),
  ((48.49149000, 9.034330000), 331.0),
  ((48.49146000, 9.034610000), 332.0),
  ((48.49141000, 9.034870000), 332.0),
  ((48.49130000, 9.035140000), 332.0),
  ((48.49121000, 9.035280000), 332.0),
  ((48.49110000, 9.035420000), 331.0),
  ((48.49112000, 9.035430000), 332.0),
  ((48.49111000, 9.035430000), 332.0),
  ((48.49155000, 9.035680000), 332.0),
  ((48.49206000, 9.035910000), 331.0),
  ((48.49215000, 9.035890000), 331.0),
  ((48.49215000, 9.035880000), 331.0),
  ((48.49258000, 9.035820000), 330.0),
  ((48.49338000, 9.035530000), 327.0),
  ((48.49372000, 9.035470000), 327.0),
  ((48.49409000, 9.035460000), 327.0),
  ((48.49443000, 9.035540000), 327.0),
  ((48.49487000, 9.035700000), 327.0),
  ((48.49531000, 9.035970000), 326.0),
  ((48.49570000, 9.036350000), 326.0),
  ((48.49598000, 9.036510000), 326.0),
  ((48.49626000, 9.036560000), 326.0),
  ((48.49625000, 9.036560000), 326.0),
  ((48.49644000, 9.036640000), 326.0),
  ((48.49654000, 9.036630000), 326.0),
  ((48.49662000, 9.036520000), 326.0),
  ((48.49673000, 9.036410000), 326.0),
  ((48.49701000, 9.036340000), 324.0),
  ((48.49732000, 9.036210000), 324.0),
  ((48.49807000, 9.035770000), 323.0),
  ((48.49847000, 9.035590000), 324.0),
  ((48.49892000, 9.035490000), 324.0),
  ((48.50089000, 9.035380000), 320.0),
  ((48.50136000, 9.035220000), 321.0),
  ((48.50162000, 9.035120000), 322.0),
  ((48.50264000, 9.036170000), 323.0),
  ((48.50263000, 9.036170000), 323.0),
  ((48.50283000, 9.036370000), 324.0),
  ((48.50309000, 9.036680000), 322.0),
  ((48.50365000, 9.037220000), 322.0),
  ((48.50369000, 9.037290000), 322.0),
  ((48.50371000, 9.037360000), 322.0),
  ((48.50369000, 9.037520000), 322.0),
  ((48.50387000, 9.037650000), 322.0),
  ((48.50405000, 9.037660000), 321.0),
  ((48.50404000, 9.037660000), 321.0),
  ((48.50415000, 9.037750000), 321.0),
  ((48.50636000, 9.040050000), 321.0),
  ((48.50636000, 9.040040000), 321.0),
  ((48.50804000, 9.041800000), 320.0),
  ((48.50838000, 9.042190000), 321.0),
  ((48.50838000, 9.042180000), 321.0),
  ((48.50845000, 9.042090000), 321.0),
  ((48.50849000, 9.041990000), 321.0),
  ((48.50872000, 9.042240000), 322.0),
  ((48.50872000, 9.042230000), 322.0),
  ((48.51010000, 9.043650000), 323.0),
  ((48.51020000, 9.043660000), 323.0),
  ((48.51028000, 9.043630000), 323.0),
  ((48.51051000, 9.043520000), 324.0),
  ((48.51045000, 9.043430000), 324.0),
  ((48.51060000, 9.043170000), 323.0),
  ((48.51064000, 9.043140000), 323.0),
  ((48.51064000, 9.043130000), 323.0),
  ((48.51074000, 9.043320000), 323.0),
  ((48.51199000, 9.044990000), 320.0),
  ((48.51209000, 9.044990000), 321.0),
  ((48.51224000, 9.044960000), 322.0),
  ((48.51230000, 9.045020000), 321.0),
  ((48.51239000, 9.044910000), 322.0),
  ((48.51254000, 9.044770000), 322.0),
  ((48.51262000, 9.044750000), 322.0),
  ((48.51278000, 9.044760000), 322.0),
  ((48.51295000, 9.044720000), 323.0),
  ((48.51309000, 9.044780000), 324.0),
  ((48.51319000, 9.044780000), 324.0),
  ((48.51327000, 9.044770000), 324.0),
  ((48.51346000, 9.044690000), 325.0),
  ((48.51363000, 9.044510000), 325.0),
  ((48.51377000, 9.044300000), 325.0),
  ((48.51404000, 9.044640000), 325.0),
  ((48.51403000, 9.044640000), 325.0),
  ((48.51435000, 9.045060000), 325.0),
  ((48.51461000, 9.045460000), 326.0),
  ((48.51544000, 9.046600000), 324.0),
  ((48.51544000, 9.046590000), 324.0),
  ((48.51566000, 9.046950000), 325.0),
  ((48.51581000, 9.047310000), 325.0),
  ((48.51636000, 9.048960000), 324.0),
  ((48.51636000, 9.048950000), 324.0),
  ((48.51638000, 9.049020000), 324.0),
  ((48.51666000, 9.048810000), 322.0),
  ((48.51697000, 9.048550000), 322.0),
  ((48.51769000, 9.048080000), 327.0),
  ((48.51784000, 9.047970000), 331.0),
  ((48.51804000, 9.047960000), 339.0),
  ((48.51925000, 9.048610000), 364.0),
  ((48.51924000, 9.048610000), 364.0),
  ((48.52022000, 9.049140000), 342.0),
  ((48.52028000, 9.049190000), 339.0),
  ((48.52027000, 9.049190000), 339.0),
  ((48.52022000, 9.049140000), 342.0),
  ((48.52036000, 9.049130000), 337.0),
  ((48.52053000, 9.049520000), 334.0),
  ((48.52057000, 9.049830000), 333.0),
  ((48.52057000, 9.049820000), 333.0),
  ((48.52057000, 9.049860000), 333.0),
  ((48.52073000, 9.049840000), 332.0),
  ((48.52091000, 9.050850000), 334.0),
  ((48.52091000, 9.050840000), 334.0),
  ((48.52113000, 9.052020000), 333.0),
  ((48.52113000, 9.052010000), 333.0),
  ((48.52113000, 9.052050000), 333.0),
  ((48.52129000, 9.052090000), 332.0),
  ((48.52203000, 9.052120000), 331.0),
  ((48.52202000, 9.052120000), 331.0),
  ((48.52238000, 9.052100000), 332.0),
  ((48.52268000, 9.052160000), 332.0),
  ((48.52282000, 9.052160000), 332.0),
  ((48.52287000, 9.052160000), 332.0),
  ((48.52294000, 9.052380000), 333.0),
  ((48.52294000, 9.052460000), 333.0),
  ((48.52295000, 9.052430000), 333.0),
  ((48.52294000, 9.052430000), 333.0),
  ((48.52296000, 9.052760000), 334.0),
  ((48.52301000, 9.053150000), 334.0),
  ((48.52308000, 9.054290000), 331.0),
  ((48.52308000, 9.054280000), 331.0),
  ((48.52318000, 9.055630000), 333.0),
  ((48.52308000, 9.055890000), 332.0),
  ((48.52302000, 9.056050000), 331.0),
  ((48.52273000, 9.056630000), 330.0),
  ((48.52263000, 9.056990000), 331.0),
  ((48.52264000, 9.057130000), 331.0),
  ((48.52264000, 9.057120000), 331.0),
  ((48.52267000, 9.057320000), 332.0),
  ((48.52283000, 9.057630000), 333.0),
  ((48.52289000, 9.057810000), 333.0),
  ((48.52297000, 9.058320000), 334.0),
  ((48.52297000, 9.058310000), 334.0),
  ((48.52299000, 9.058440000), 334.0),
  ((48.52303000, 9.058540000), 334.0),
  ((48.52357000, 9.059020000), 334.0),
  ((48.52356000, 9.059020000), 334.0),
  ((48.52384000, 9.059450000), 332.0),
  ((48.52392000, 9.059510000), 331.0),
  ((48.52394000, 9.059660000), 330.0),
  ((48.52469000, 9.060340000), 330.0),
  ((48.52500000, 9.059520000), 334.0),
  ((48.52502000, 9.059540000), 334.0),
  ((48.52502000, 9.059530000), 334.0),
  ((48.52664000, 9.060980000), 330.0),
  ((48.52664000, 9.060970000), 330.0),
  ((48.52859000, 9.062710000), 327.0),
  ((48.52894000, 9.063060000), 328.0),
  ((48.52894000, 9.063050000), 328.0),
  ((48.52921000, 9.063240000), 327.0),
  ((48.52975000, 9.063740000), 330.0),
  ((48.53006000, 9.063990000), 331.0),
  ((48.53057000, 9.064500000), 331.0),
  ((48.53065000, 9.064670000), 331.0),
  ((48.53078000, 9.065080000), 331.0),
  ((48.53078000, 9.065070000), 331.0),
  ((48.53104000, 9.065840000), 332.0),
  ((48.53143000, 9.066520000), 337.0),
  ((48.53154000, 9.066790000), 338.0),
  ((48.53169000, 9.067310000), 337.0),
  ((48.53172000, 9.067720000), 334.0),
  ((48.53172000, 9.067710000), 334.0),
  ((48.53173000, 9.067960000), 333.0),
  ((48.53191000, 9.067920000), 333.0),
  ((48.53203000, 9.067900000), 334.0),
  ((48.53250000, 9.067700000), 343.0),
  ((48.53327000, 9.067270000), 347.0),
  ((48.53349000, 9.067180000), 348.0),
  ((48.53374000, 9.067110000), 350.0),
  ((48.53403000, 9.067090000), 355.0),
  ((48.53408000, 9.067170000), 357.0),
  ((48.53408000, 9.067160000), 356.0),
  ((48.53419000, 9.067340000), 361.0),
  ((48.53467000, 9.067500000), 366.0),
  ((48.53507000, 9.067860000), 382.0),
  ((48.53506000, 9.067860000), 382.0),
  ((48.53528000, 9.068060000), 388.0),
  ((48.53528000, 9.068050000), 387.0),
  ((48.53513000, 9.068160000), 392.0),
  ((48.53485000, 9.068180000), 391.0),
  ((48.53460000, 9.068220000), 388.0),
  ((48.53461000, 9.068230000), 389.0),
  ((48.53461000, 9.068220000), 389.0),
  ((48.53493000, 9.068530000), 398.0),
  ((48.53493000, 9.068520000), 397.0),
  ((48.53522000, 9.068810000), 398.0),
  ((48.53521000, 9.068810000), 398.0),
  ((48.53523000, 9.068830000), 398.0),
  ((48.53501000, 9.068920000), 398.0),
  ((48.53499000, 9.068960000), 398.0),
  ((48.53524000, 9.068950000), 399.0),
  ((48.53571000, 9.068910000), 401.0),
  ((48.53579000, 9.068930000), 402.0),
  ((48.53578000, 9.068930000), 402.0),
  ((48.53581000, 9.068940000), 402.0),
  ((48.53574000, 9.069060000), 402.0),
  ((48.53552000, 9.069170000), 401.0),
  ((48.53544000, 9.069170000), 401.0),
  ((48.53501000, 9.069220000), 399.0),
  ((48.53501000, 9.069180000), 399.0),
  ((48.53501000, 9.069170000), 399.0),
  ((48.53498000, 9.070320000), 405.0),
  ((48.53498000, 9.070640000), 406.0),
  ((48.53504000, 9.070680000), 406.0),
  ((48.53515000, 9.070850000), 405.0),
  ((48.53515000, 9.071170000), 404.0),
  ((48.53514000, 9.071790000), 406.0),
  ((48.53493000, 9.071780000), 405.0),
  ((48.53481000, 9.071830000), 406.0),
  ((48.53477000, 9.071970000), 406.0);

